@model DetainedLicense

@{
    ViewData["Title"] = "فك حجز رخصة";

    string? ErrorMessage = TempData["ErrorMessage"] as string;
    bool CanPerformLicenseAction = ViewBag.CanPerformLicenseAction;
    bool ShowErrorModal = !string.IsNullOrEmpty(ErrorMessage);
    string disabled = !CanPerformLicenseAction ? "disabled" : "";
    string DisabledFilter = Model.Id != 0 ? "disabled" : "";
}

<div class="main-content my-3 my-lg-4">
    <div class="container">
        <div class="bg-white p-3">
            <partial name="_ErrorMessage" model="@ErrorMessage" />
            <form asp-action="SearchLocalLicense" id="searchForm" class="@DisabledFilter get row align-items-center justify-content-between gy-3 gx-0">
                <div class="col-12 col-lg-6 d-flex flex-column flex-lg-row align-items-lg-center">
                    <input type="hidden" name="LicenseAction" value="@DetainedLicense.enLicenseAction.Release" />
                    <label class="fw-semibold me-lg-2 mb-2 mb-lg-0 text-nowrap">رقم الرخصة المحلية : </label>
                    <div class="d-flex flex-grow-1">
                        <input type="text" id="searchValue" name="LicenseId" class="form-control d-inline-block" />
                        <button id="btnSearch" type="submit" class="btn btn-primary ms-2">بحث</button>
                    </div>
                </div>
            </form>
            <partial name="_LicenseInfo" model="@Model.License" />
            <div class="card shadow border-0 mt-3">
                <div class="card-header bg-primary p-3">
                    <h5 class="text-white mb-0">معلومات فك الحجز</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        @if (Model.Id == 0)
                        {
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <i class="fa-solid fa-hashtag fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">رقم الحجز : </label>
                                    <span>???</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-calendar-days fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">تاريخ الحجز : </label>
                                    <span>???</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">رسوم الطلب : </label>
                                    <span>@Model.Application.PaidFees</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">إجمالي الرسوم : </label>
                                    <span>@(Model.FineFees + Model.Application.PaidFees)</span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <i class="fa-solid fa-hashtag fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">رقم الرخصة المحجوزة : </label>
                                    <span>؟؟؟</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-user fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">محتجزة من قبل  : </label>
                                    <span>؟؟؟</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">الغرامة المالية   : </label>
                                    <span>؟؟؟</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2"></i>
                                    <label class="fw-semibold">فك الحجز من قبل   : </label>
                                    <span>@Model.ReleasedByUser.UserName</span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <i class="fa-solid fa-hashtag fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">رقم الحجز : </label>
                                    <span>@Model.LicenseId</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-calendar-days fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">تاريخ الحجز : </label>
                                    <span>@Model.DetainDate.ToShortDateString()</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">رسوم الطلب : </label>
                                    <span>@Model.Application.PaidFees</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">إجمالي الرسوم : </label>
                                    <span>@(Model.FineFees + Model.Application.PaidFees)</span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <i class="fa-solid fa-hashtag fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">رقم الرخصة المحجوزة : </label>
                                    <span>@Model.LicenseId</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-user fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">محتجزة من قبل  : </label>
                                    <span>@Model.DetainedByUser.UserName</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">الغرامة المالية : </label>
                                    <span>@Model.FineFees</span>
                                </div>
                                <div class="mb-3">
                                    <i class="fa-solid fa-coins fa-fw fa-lg me-2 icon-primary"></i>
                                    <label class="fw-semibold">فك الحجز من قبل   : </label>
                                    <span>@Model.ReleasedByUser.UserName</span>
                                </div>
                            </div>
                        }

                        <form method="post" asp-action="Release">
                            @* Detained License Hidden Fields *@
                            <input asp-for="@Model.Id" hidden />
                            <input asp-for="@Model.LicenseId" hidden />
                            <input asp-for="@Model.DetainDate" hidden />
                            <input asp-for="@Model.ReleaseDate" hidden />
                            <input asp-for="@Model.DetainedByUserId" hidden />
                            <input asp-for="@Model.ReleasedByUserId" hidden />
                            <input asp-for="@Model.IsReleased" hidden />
                            <input asp-for="@Model.ReleaseApplicationId" hidden />
                            <input asp-for="@Model.IsReleased" hidden />
                            <input asp-for="@Model.FineFees" hidden />

                            @* Application Hidden Fields *@
                            <input asp-for="@Model.Application.ApplicationDate" hidden />
                            <input asp-for="@Model.Application.ApplicationStatus" hidden />
                            <input asp-for="@Model.Application.LastStatusDate" hidden />
                            <input asp-for="@Model.Application.PaidFees" hidden />
                            <input asp-for="@Model.Application.PersonId" hidden />
                            <input asp-for="@Model.Application.ApplicationTypeId" hidden />
                            <input asp-for="@Model.Application.CreatedByUserId" hidden />

                            <button type="submit" class="btn btn-primary mt-4 @disabled">
                                <i class="fa-solid fa-id-card fa-fw fa-lg me-2"></i>فك حجز الرخصة
                            </button>

                        </form>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>



@section Scripts {
    <script>
        $(document).ready(function () {
            var showErrorModal = @ShowErrorModal.ToString().ToLower();

            if (showErrorModal == true) {
                $('#errorModal').modal('show');
            };
        });
    </script>
}
