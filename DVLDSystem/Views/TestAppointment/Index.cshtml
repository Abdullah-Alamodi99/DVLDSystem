@model TestAppointmentVM
@{
    ViewData["Title"] = "مواعيد الفحص";

    string ErrorMessage = TempData["ErrorMessage"] as string;
    bool ShowErrorModal = !string.IsNullOrEmpty(ErrorMessage);
}
<div class="main-content mb-3">
    <div class="container">

        <partial name="_ErrorMessage" model="@ErrorMessage" />

        <div class="mt-3 mt-md-5 mb-4">
            <partial name="_DrivingLicenseApplicationInfo" model="@Model.LocalDrivingLicenseApplication" />
        </div>
        <hr />

        <div class="w-100 d-flex justify-content-between align-items-center gap-2 pb-3">
            <h5 class="mb-0">المواعيد</h5>
            <a asp-controller="TestAppointment"
               asp-action="AddEdit"
               asp-route-Id=""
               asp-route-LDLAppId="@Model.LocalDrivingLicenseApplication.Id"
               asp-route-TestTypeId="@Model.TestType.Id"
               class="btn btn-primary my-2 mb-sm-0">
                <i class="fa-solid fa-circle-plus me-2"></i> أضافة موعد
            </a>
        </div>

        <div class="table-responsive bg-white rounded p-3 shadow" style="overflow-x:auto;">
            <table class="table table-striped table-borderless align-middle text-center mb-0" style="white-space: nowrap;">
                <thead>
                    <tr>
                        <th>رقم الموعد</th>
                        <th>تاريخ الموعد</th>
                        <th>الرسوم المدفوعه</th>
                        <th>مقفل</th>
                        <th>العمليات</th>
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.TestAppointments.Any() || Model.TestAppointments == null)
                    {
                        <tr>
                            <td colspan="5" class="text-center text-muted py-3">
                                لا توجد مواعيد
                            </td>
                        </tr>
                    }
                    else
                    {
                        @foreach (var Appointment in Model.TestAppointments)
                        {
                            <tr>
                                <td>@Appointment.Id</td>
                                <td>@Appointment.Date.ToShortDateString()</td>
                                <td>@Appointment.PaidFees</td>
                                <td>
                                    <input type="checkbox" @(Appointment.IsLocked ? "checked" : "disabled") class="input-checkbox-disabled" />
                                </td>
                                <td>
                                    <div class="dropdown position-static">
                                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            العمليات
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                            <a asp-controller="TestAppointment" asp-action="AddEdit"
                                               asp-route-Id="@Appointment.Id"
                                               asp-route-LDLAppId="@Appointment.LocalDrivingLicenseApplicationId"
                                               asp-route-TestTypeId="@Appointment.TestTypeId"
                                               class="dropdown-item">
                                                <i class="fa-solid fa-pencil fa-lg fa-fw me-2 icon-secondary"></i> تعديل الموعد
                                            </a>
                                            <div><hr class="dropdown-divider" /></div>
                                            <a asp-controller="Test" asp-action="Take"
                                               asp-route-TestAppointmentId="@Appointment.Id"
                                               class="dropdown-item">
                                                <i class="fa-solid fa-notes-medical fa-lg fa-fw me-2 icon-secondary"></i> عمل الفحص
                                            </a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var showErrorModal = @ShowErrorModal.ToString().ToLower();
            if (showErrorModal === true) {
                $('#errorModal').modal('show');
            }
        });
    </script>
}
